# Instructions pour Assistants IA - MonBudget v2

## üö® S√âCURIT√â : R√àGLES ABSOLUES

### ‚ùå INTERDICTIONS STRICTES

Vous **NE DEVEZ JAMAIS** :

1. **Commiter/pusher des fichiers SQL avec donn√©es r√©elles**
   - `database.sql` DOIT contenir UNIQUEMENT la structure (--no-data)
   - Aucun INSERT INTO avec IBAN, noms, adresses, emails, t√©l√©phones
   - V√©rifier syst√©matiquement avant commit : `grep -c "INSERT INTO" database.sql` = 0

2. **Exposer des credentials**
   - Aucun mot de passe en clair dans `config/app.php`
   - Aucun credential dans `phpunit.xml`
   - Utiliser `.env` ou variables d'environnement

3. **Utiliser des donn√©es personnelles r√©elles**
   - Lors de g√©n√©ration d'exemples SQL
   - Dans les fixtures de tests
   - Dans la documentation

### ‚úÖ ACTIONS REQUISES AVANT COMMIT

**üîí SCRIPT D'AUDIT AUTOMATIQUE (RECOMMAND√â)** :
```powershell
# Ex√©cuter AVANT tout push
.\security-audit.ps1

# Options disponibles
.\security-audit.ps1 -Strict  # Bloque le push si erreur
.\security-audit.ps1 -Auto    # Corrige automatiquement (BOM, etc.)
```

**Checklist manuelle alternative** :
```bash
# 1. V√©rifier database.sql (doit retourner 0)
grep -c "INSERT INTO" database.sql

# 2. V√©rifier absence IBAN
git diff --cached | grep -vE "FR[0-9]{25}"

# 3. V√©rifier absence emails r√©els
git diff --cached | grep -vE "@(gmail|outlook|hotmail|yahoo)\.(com|fr)"

# 4. V√©rifier absence mots de passe
git diff --cached | grep -vi "password.*=.*['\"][^'\"]{8,}"
```

**Si l'une de ces v√©rifications √©choue** : STOP et demander confirmation.

---

## üìù Donn√©es de test autoris√©es

### Utilisateurs fictifs
```json
{
  "nom": "Dupont",
  "prenom": "Jean",
  "email": "jean.dupont@example.com",
  "telephone": "01 23 45 67 89",
  "adresse": "123 Rue de la Paix, 75000 Paris"
}
```

### Coordonn√©es bancaires fictives
```
IBAN: FR7630006000011234567890189 (valide mais fictif)
BIC: BNPAFRPPXXX
Nom banque: Banque de Test SA
```

### Transactions de test
```sql
-- ‚úÖ AUTORIS√â
INSERT INTO transactions (libelle, montant, date_transaction)
VALUES ('Courses Supermarch√©', 45.50, '2025-01-15');

-- ‚ùå INTERDIT
INSERT INTO transactions (beneficiaire, montant)
VALUES ('CARREFOUR WASQUEHAL RUE JEAN MACE', 45.50);  -- Adresse r√©elle !
```

---

## üîß Processus de g√©n√©ration database.sql

### Commande correcte (structure seule)
```bash
mysqldump -u root -p \
  --default-character-set=utf8mb4 \
  --no-data \
  --single-transaction \
  monbudget_v2 > database.sql
```

### ‚ùå Commande INTERDITE (avec donn√©es)
```bash
# NE JAMAIS FAIRE √áA :
mysqldump -u root -p monbudget_v2 > database.sql
```

### V√©rification post-export
```powershell
# Supprimer BOM UTF-8
$content = Get-Content database.sql -Raw
$utf8NoBom = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText("$PWD\database.sql", $content, $utf8NoBom)

# V√©rifier absence de donn√©es
(Get-Content database.sql | Select-String "^INSERT INTO").Count  # Doit √™tre 0
```

---

## üö® Incident de s√©curit√© d√©tect√©

### Si vous d√©tectez des donn√©es sensibles dans un commit

**√âTAPE 1** : Alerter imm√©diatement l'utilisateur
```
‚ö†Ô∏è  ALERTE S√âCURIT√â : Donn√©es sensibles d√©tect√©es dans {fichier}
- IBAN trouv√©s : X
- Emails personnels : X
- Mots de passe : X

Action requise : Purge historique Git
Voulez-vous que je proc√®de au nettoyage ?
```

**√âTAPE 2** : Proposer la proc√©dure de nettoyage
```bash
# Purge du fichier de l'historique complet
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch {fichier}" \
  --prune-empty --tag-name-filter cat -- --all

# Force push (√©crase l'historique distant)
git push origin --force --all
git push origin --force --tags

# Nettoyage local
rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

**√âTAPE 3** : Documenter l'incident
- Ajouter entr√©e dans SECURITY.md
- Notifier dans le commit de correction
- Sugg√©rer rotation des secrets expos√©s

---

## üìö Fichiers de r√©f√©rence

**Toujours consulter avant modification** :
- `SECURITY.md` - Politiques de s√©curit√© compl√®tes
- `.gitignore` - Liste des fichiers √† ne jamais tracker
- `docs/DEPLOIEMENT.md` - Proc√©dures s√©curis√©es

**Fichiers sensibles prot√©g√©s par .gitignore** :
- `database_with_data.sql`
- `database_clean.sql`
- `database_*.sql` (sauf structure)
- `config/installed.json`
- `.env*` (sauf .example)

---

## üéØ Objectifs de cette configuration

1. **Protection RGPD** : Aucune donn√©e personnelle identifiable sur GitHub
2. **S√©curit√© credentials** : Aucun mot de passe/token expos√©
3. **Reproductibilit√©** : Installation propre possible sans donn√©es de test
4. **Conformit√©** : Respect des bonnes pratiques OWASP

---

**Historique des incidents** :
- 18/11/2025 : Exposition IBAN/coordonn√©es dans database.sql (commit a441678) ‚Üí R√©solu par purge Git

**Ce fichier est lu automatiquement par les assistants IA GitHub Copilot, Cursor, Continue, etc.**
